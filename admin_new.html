<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Control Panel - Mood Cafe</title>
    
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    
    <style>
        .hidden {
            display: none !important;
        }
        .admin-section {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .admin-section.active {
            opacity: 1;
        }
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-lg w-96">
            <h2 class="text-2xl font-bold mb-6">Admin Login</h2>
            <form id="adminLoginForm" class="space-y-4">
                <div>
                    <label class="block text-gray-400 mb-2">Admin ID</label>
                    <input type="text" id="adminId" class="w-full bg-gray-700 rounded p-3" required>
                </div>
                <div>
                    <label class="block text-gray-400 mb-2">Password</label>
                    <input type="password" id="adminPassword" class="w-full bg-gray-700 rounded p-3" required>
                </div>
                <button type="submit" class="w-full bg-purple-600 py-3 rounded-lg hover:bg-purple-700 transition-colors">
                    Login to Admin Panel
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Interface -->
    <div id="adminInterface" class="hidden">
        <div class="flex h-screen">
            <!-- Sidebar -->
            <aside class="w-64 bg-gray-800 border-r border-gray-700">
                <div class="p-4">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 rounded-lg bg-purple-600 flex items-center justify-center">
                            <i class="fas fa-lock"></i>
                        </div>
                        <div>
                            <h2 class="font-bold">Admin Panel</h2>
                            <p class="text-sm text-gray-400">Mood Cafe Control</p>
                        </div>
                    </div>

                    <nav class="space-y-2">
                        <button onclick="showSection('dashboard')" class="w-full flex items-center gap-3 p-3 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-chart-line w-6"></i>
                            <span>Dashboard</span>
                        </button>
                        <button onclick="showSection('users')" class="w-full flex items-center gap-3 p-3 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-users w-6"></i>
                            <span>Users</span>
                        </button>
                        <button onclick="showSection('menu')" class="w-full flex items-center gap-3 p-3 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-utensils w-6"></i>
                            <span>Menu</span>
                        </button>
                        <button onclick="showSection('orders')" class="w-full flex items-center gap-3 p-3 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-shopping-cart w-6"></i>
                            <span>Orders</span>
                        </button>
                        <button id="logoutBtn" class="w-full flex items-center gap-3 p-3 text-red-400 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-sign-out-alt w-6"></i>
                            <span>Logout</span>
                        </button>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-1 overflow-y-auto p-8">
                <!-- Dashboard -->
                <section id="dashboard" class="admin-section">
                    <h2 class="text-2xl font-bold mb-6">Dashboard Overview</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card bg-gray-800 p-6 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-gray-400">Total Users</h3>
                                <i class="fas fa-users text-purple-500"></i>
                            </div>
                            <p id="totalUsers" class="text-2xl font-bold">0</p>
                            <p class="text-sm text-green-500">+12% this week</p>
                        </div>
                        <div class="stat-card bg-gray-800 p-6 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-gray-400">Total Orders</h3>
                                <i class="fas fa-shopping-cart text-purple-500"></i>
                            </div>
                            <p id="totalOrders" class="text-2xl font-bold">0</p>
                            <p class="text-sm text-green-500">+8% this week</p>
                        </div>
                        <div class="stat-card bg-gray-800 p-6 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-gray-400">Revenue</h3>
                                <i class="fas fa-rupee-sign text-purple-500"></i>
                            </div>
                            <p id="totalRevenue" class="text-2xl font-bold">₹0</p>
                            <p class="text-sm text-green-500">+15% this week</p>
                        </div>
                        <div class="stat-card bg-gray-800 p-6 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="text-gray-400">Active Users</h3>
                                <i class="fas fa-circle text-green-500"></i>
                            </div>
                            <p id="activeUsers" class="text-2xl font-bold">0</p>
                            <p class="text-sm text-purple-500">Currently Online</p>
                        </div>
                    </div>
                </section>

                <!-- Users Section -->
                <section id="users" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">User Management</h2>
                        <button onclick="openAddUserModal()" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-user-plus mr-2"></i>Add User
                        </button>
                    </div>
                    
                    <!-- User Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">Active Users</h3>
                            <div class="flex items-center gap-4">
                                <div class="text-3xl font-bold" id="activeUsersCount">0</div>
                                <div class="flex -space-x-4">
                                    <!-- Active user avatars will be inserted here -->
                                </div>
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">New Users Today</h3>
                            <div class="text-3xl font-bold" id="newUsersCount">0</div>
                            <div class="text-sm text-green-500">+5% from yesterday</div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">Premium Users</h3>
                            <div class="text-3xl font-bold" id="premiumUsersCount">0</div>
                            <div class="text-sm text-purple-500">15% of total users</div>
                        </div>
                    </div>

                    <!-- Users Table -->
                    <div class="bg-gray-800 rounded-lg overflow-hidden">
                        <table id="usersTable" class="w-full">
                            <thead>
                                <tr class="bg-gray-700">
                                    <th class="px-6 py-3 text-left">User</th>
                                    <th class="px-6 py-3 text-left">Email</th>
                                    <th class="px-6 py-3 text-left">Status</th>
                                    <th class="px-6 py-3 text-left">Join Date</th>
                                    <th class="px-6 py-3 text-left">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody"></tbody>
                        </table>
                    </div>
                </section>

                <!-- Menu Section -->
                <section id="menu" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Menu Management</h2>
                        <div class="flex gap-4">
                            <select id="menuCategory" class="bg-gray-800 rounded-lg px-4 py-2">
                                <option value="all">All Categories</option>
                                <option value="Main Course">Main Course</option>
                                <option value="Breakfast">Breakfast</option>
                                <option value="Beverages">Beverages</option>
                            </select>
                            <button onclick="openAddMenuItemModal()" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Add Item
                            </button>
                        </div>
                    </div>

                    <!-- Menu Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">Total Items</h3>
                            <div class="text-3xl font-bold" id="totalMenuItems">0</div>
                            <div class="text-sm text-purple-500">Across all categories</div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">Popular Items</h3>
                            <div id="popularItems" class="space-y-2">
                                <!-- Popular items will be listed here -->
                            </div>
                        </div>
                        <div class="bg-gray-800 p-6 rounded-lg">
                            <h3 class="text-gray-400 mb-2">Category Distribution</h3>
                            <canvas id="categoryChart" height="150"></canvas>
                        </div>
                    </div>

                    <!-- Menu Grid -->
                    <div id="menuGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Menu items will be populated here -->
                    </div>
                </section>

                <!-- Orders Section -->
                <section id="orders" class="admin-section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Orders & Transactions</h2>
                        <div class="flex gap-4">
                            <button onclick="openAddOrderModal()" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-plus mr-2"></i>Add Transaction
                            </button>
                        </div>
                    </div>

                        <!-- Order Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="bg-gray-800 p-6 rounded-lg">
                                <h3 class="text-gray-400 mb-2">Total Bookings</h3>
                                <div class="text-3xl font-bold" id="totalBookingsCount">0</div>
                                <div class="text-sm text-purple-500">Zone + Event bookings</div>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg">
                                <h3 class="text-gray-400 mb-2">Total Revenue</h3>
                                <div class="text-3xl font-bold" id="totalBookingRevenue">₹0</div>
                                <div class="text-sm text-green-500">From all bookings</div>
                            </div>
                            <div class="bg-gray-800 p-6 rounded-lg">
                                <h3 class="text-gray-400 mb-2">Recent Bookings</h3>
                                <div class="text-3xl font-bold" id="recentBookingsCount">0</div>
                                <div class="text-sm text-blue-500">Last 7 days</div>
                            </div>
                        </div>

                        <div class="bg-gray-800 rounded-lg overflow-hidden p-4">
                            <h3 class="font-semibold text-lg mb-4">All Bookings & Transactions</h3>
                        <table id="ordersTable" class="w-full">
                            <thead>
                                <tr class="bg-gray-700">
                                        <th class="px-6 py-3 text-left">Booking ID</th>
                                    <th class="px-6 py-3 text-left">User</th>
                                    <th class="px-6 py-3 text-left">Amount</th>
                                    <th class="px-6 py-3 text-left">Date</th>
                                    <th class="px-6 py-3 text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody"></tbody>
                        </table>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="addUserModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-96" role="dialog" aria-modal="true" aria-labelledby="addUserTitle">
            <h3 class="text-lg font-semibold mb-3">Add User</h3>
            <form id="addUserForm" class="space-y-3">
                <input id="newUserName" class="w-full p-2 rounded bg-gray-700" placeholder="Full name" required />
                <input id="newUserEmail" class="w-full p-2 rounded bg-gray-700" placeholder="Email" type="email" required />
                <select id="newUserRole" class="w-full p-2 rounded bg-gray-700">
                    <option value="user">User</option>
                    <option value="premium">Premium</option>
                </select>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeAddUserModal()" class="px-3 py-2 rounded bg-white/5">Cancel</button>
                    <button type="submit" class="px-3 py-2 rounded bg-purple-600">Add</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addMenuItemModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-[520px]" role="dialog" aria-modal="true" aria-labelledby="addMenuItemTitle">
            <h3 id="addMenuItemTitle" class="text-lg font-semibold mb-3">Add Menu Item</h3>
            <form id="addMenuItemForm" class="space-y-3">
                <input id="menuItemName" class="w-full p-2 rounded bg-gray-700" placeholder="Item name" required />
                <textarea id="menuItemDesc" class="w-full p-2 rounded bg-gray-700" placeholder="Description"></textarea>
                <div class="flex gap-2">
                    <input id="menuItemPrice" class="w-1/3 p-2 rounded bg-gray-700" placeholder="Price" type="number" min="0" required />
                    <select id="menuItemCategory" class="w-2/3 p-2 rounded bg-gray-700">
                        <option value="Main Course">Main Course</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Beverages">Beverages</option>
                    </select>
                </div>
                <div>
                    <label class="text-sm text-gray-400">Photo</label>
                    <input id="menuItemPhoto" type="file" accept="image/*" class="w-full" />
                </div>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeAddMenuItemModal()" class="px-3 py-2 rounded bg-white/5">Cancel</button>
                    <button type="submit" class="px-3 py-2 rounded bg-purple-600">Add Item</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addOrderModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 p-6 rounded-lg w-96" role="dialog" aria-modal="true" aria-labelledby="addOrderTitle">
            <h3 id="addOrderTitle" class="text-lg font-semibold mb-3">Add Transaction</h3>
            <form id="addOrderForm" class="space-y-3">
                <input id="orderUser" class="w-full p-2 rounded bg-gray-700" placeholder="User email or name" required />
                <input id="orderAmount" class="w-full p-2 rounded bg-gray-700" placeholder="Amount" type="number" min="0" required />
                <input id="orderDate" class="w-full p-2 rounded bg-gray-700" type="date" required />
                <select id="orderStatus" class="w-full p-2 rounded bg-gray-700">
                    <option value="completed">Completed</option>
                    <option value="pending">Pending</option>
                    <option value="failed">Failed</option>
                </select>
                <div class="flex justify-end gap-2">
                    <button type="button" onclick="closeAddOrderModal()" class="px-3 py-2 rounded bg-white/5">Cancel</button>
                    <button type="submit" class="px-3 py-2 rounded bg-purple-600">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="adminControl.js"></script>
    <script src="monitoring.js"></script>
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script>
        // Main Admin Panel Logic
        document.addEventListener('DOMContentLoaded', function() {
            // Handle Login
            const loginForm = document.getElementById('adminLoginForm');
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const adminId = document.getElementById('adminId').value;
                const password = document.getElementById('adminPassword').value;

                if (adminId === 'admin' && password === 'admin123') {
                    document.getElementById('loginModal').classList.add('hidden');
                    document.getElementById('adminInterface').classList.remove('hidden');
                    initializeAdmin();
                } else {
                    showToast('Invalid credentials', 'error');
                }
            });

            // Handle Logout
            document.getElementById('logoutBtn').addEventListener('click', function() {
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('adminInterface').classList.add('hidden');
            });
        });

        // Initialize Admin Panel
        function initializeAdmin() {
            showSection('dashboard');
            updateStats();
            
            // Listen for updates from monitoring system
            window.addEventListener('moodCafeMetricsUpdate', function(event) {
                updateStats(event.detail);
            });
        }

        // Show Section
        function showSection(sectionId) {
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.add('hidden');
                section.classList.remove('active');
            });
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('hidden');
                setTimeout(() => section.classList.add('active'), 10);
            }
        }

        // Update Statistics
        function updateStats(metrics) {
            if (!metrics) {
                // Get initial data from adminControl
                const data = window.moodCafeAdmin.getData();
                document.getElementById('totalUsers').textContent = data.stats.totalUsers;
                document.getElementById('totalOrders').textContent = data.stats.totalOrders;
                document.getElementById('totalRevenue').textContent = '₹' + data.stats.revenue.toLocaleString();
                document.getElementById('activeUsers').textContent = data.stats.activeUsers;
            } else {
                // Update with live metrics
                document.getElementById('activeUsers').textContent = metrics.activeUsers;
                // Update other metrics as needed
            }
        }
        // Chart initialization
        function initializeCharts() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            window.categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Main Course', 'Breakfast', 'Beverages'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#9333ea', '#7c3aed', '#6366f1']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#9ca3af'
                            }
                        }
                    }
                }
            });
        }

        // Update Menu Stats
        function updateMenuStats() {
            const data = window.moodCafeAdmin.getData();
            const menuItems = data.menuItems || [];
            
            // Update total items
            document.getElementById('totalMenuItems').textContent = menuItems.length;

            // Update category distribution
            const categories = menuItems.reduce((acc, item) => {
                acc[item.category] = (acc[item.category] || 0) + 1;
                return acc;
            }, {});

            if (window.categoryChart) {
                window.categoryChart.data.datasets[0].data = [
                    categories['Main Course'] || 0,
                    categories['Breakfast'] || 0,
                    categories['Beverages'] || 0
                ];
                window.categoryChart.update();
            }

            // Update popular items
            const popularItemsDiv = document.getElementById('popularItems');
            const sortedItems = [...menuItems].sort((a, b) => (b.orders || 0) - (a.orders || 0)).slice(0, 3);
            popularItemsDiv.innerHTML = sortedItems.map(item => `
                <div class="flex items-center justify-between">
                    <span class="text-sm">${item.name}</span>
                    <span class="text-xs text-purple-500">${item.orders || 0} orders</span>
                </div>
            `).join('');
        }

        // Initialize DataTables
        function initializeTables() {
            $('#usersTable').DataTable({
                pageLength: 10,
                searching: true,
                ordering: true
            });
        }

        // Initialize everything when admin panel loads
        function initializeAdmin() {
            showSection('dashboard');
            updateStats();
            initializeCharts();
            initializeTables();
            
            // Listen for updates
            window.addEventListener('moodCafeMetricsUpdate', function(event) {
                updateStats(event.detail);
                updateMenuStats();
            });

            // Initial menu stats update
            updateMenuStats();
        }

        // --- Admin UI helpers: modals, toasts, forms and rendering ---
        // Toast system
        (function(){
            const container = document.createElement('div'); container.id='toastContainer'; container.className='fixed right-4 bottom-6 z-60 space-y-2 w-96'; document.body.appendChild(container);
            window.showToast = function(message, type='info', timeout=3500){
                const t = document.createElement('div');
                t.className = `p-3 rounded-lg shadow-lg text-sm ${type==='error'? 'bg-red-600' : type==='success'? 'bg-green-600' : 'bg-gray-800'} text-white`;
                t.setAttribute('role','status'); t.innerText = message;
                container.appendChild(t);
                setTimeout(()=>{ t.classList.add('opacity-0'); setTimeout(()=>t.remove(),400); }, timeout);
            };
        })();

        // Focus trap helper for modal dialogs
        function trapFocus(modalEl){
            const focusable = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), [tabindex]:not([tabindex="-1"])';
            const first = modalEl.querySelectorAll(focusable)[0];
            const nodes = modalEl.querySelectorAll(focusable);
            const last = nodes[nodes.length-1];
            function keyHandler(e){
                if (e.key === 'Tab'){
                    if (e.shiftKey){ if (document.activeElement === first){ e.preventDefault(); last.focus(); } }
                    else { if (document.activeElement === last){ e.preventDefault(); first.focus(); } }
                } else if (e.key === 'Escape'){
                    modalEl.classList.add('hidden'); document.removeEventListener('keydown', keyHandler);
                }
            }
            document.addEventListener('keydown', keyHandler);
            // focus first
            if(first) first.focus();
        }

        // Open/close modals (with accessibility)
        function openAddUserModal(){ const m=document.getElementById('addUserModal'); m.classList.remove('hidden'); trapFocus(m); }
        function closeAddUserModal(){ const m=document.getElementById('addUserModal'); m.classList.add('hidden'); document.getElementById('addUserForm').reset(); }
        function openAddMenuItemModal(){ const m=document.getElementById('addMenuItemModal'); m.classList.remove('hidden'); trapFocus(m); }
        function closeAddMenuItemModal(){ const m=document.getElementById('addMenuItemModal'); m.classList.add('hidden'); document.getElementById('addMenuItemForm').reset(); }
        function openAddOrderModal(){ const m=document.getElementById('addOrderModal'); m.classList.remove('hidden'); trapFocus(m); }
        function closeAddOrderModal(){ const m=document.getElementById('addOrderModal'); m.classList.add('hidden'); document.getElementById('addOrderForm').reset(); }

        // Render users table from storage
        function renderUsersTable(){
            const data = window.moodCafeAdmin.getData();
            const users = data.users || [];
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td class="px-6 py-3">${u.name || ''}</td>
                    <td class="px-6 py-3">${u.email || ''}</td>
                    <td class="px-6 py-3">${u.status || 'active'}</td>
                    <td class="px-6 py-3">${u.joinDate || ''}</td>
                    <td class="px-6 py-3"><button onclick="removeUser(${u.id})" class="text-red-400">Remove</button></td>
                </tr>
            `).join('');
            // Re-draw DataTable if exists
            if ($.fn.dataTable.isDataTable('#usersTable')){
                $('#usersTable').DataTable().destroy();
                initializeTables();
            }
        }

        // Remove user helper
        function removeUser(id){ if(!confirm('Remove user?')) return; window.moodCafeAdmin.updateUser(id, { status:'removed' }); renderUsersTable(); }

        // Render menu grid
        function renderMenuGrid(){
            const data = window.moodCafeAdmin.getData();
            const menuItems = data.menuItems || [];
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = menuItems.map(item => `
                <div class="bg-gray-800 p-4 rounded-lg">
                    <div class="h-40 bg-gray-700 rounded mb-3 overflow-hidden flex items-center justify-center">${item.photo ? `<img src="${item.photo}" class="object-cover w-full h-full" />` : '<i class="fas fa-utensils text-3xl text-gray-400"></i>'}</div>
                    <div class="font-semibold">${item.name}</div>
                    <div class="text-sm text-slate-400">${item.category} • ₹${item.price}</div>
                    <div class="mt-3 flex items-center justify-between"><button onclick="editMenuItem(${item.id})" class="text-sm text-white/80">Edit</button><button onclick="removeMenuItem(${item.id})" class="text-sm text-red-400">Delete</button></div>
                </div>
            `).join('');
        }

    function editMenuItem(id){ showToast('Edit not implemented in this demo.', 'info'); }
        function removeMenuItem(id){ if(!confirm('Delete item?')) return; window.moodCafeAdmin.removeMenuItem(id); renderMenuGrid(); updateMenuStats(); }

        // Render orders table
        function renderOrdersTable(){
            const data = window.moodCafeAdmin.getData();
            const orders = data.orders || [];
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = orders.map(o => `
                <tr>
                    <td class="px-6 py-3">${o.id}</td>
                    <td class="px-6 py-3">${o.user || ''}</td>
                    <td class="px-6 py-3">₹${Number(o.total).toFixed(2)}</td>
                    <td class="px-6 py-3">${o.date || ''}</td>
                    <td class="px-6 py-3">${o.status || ''}</td>
                </tr>
            `).join('');
        }

            function updateBookingStats(){
                const data = window.moodCafeAdmin.getData();
                const orders = data.orders || [];
            
                // Total bookings
                document.getElementById('totalBookingsCount').textContent = orders.length;
            
                // Total revenue
                const totalRevenue = orders.reduce((sum, o) => sum + (Number(o.total) || 0), 0);
                document.getElementById('totalBookingRevenue').textContent = '₹' + totalRevenue.toFixed(0);
            
                // Recent bookings (last 7 days)
                const today = new Date();
                const sevenDaysAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                const recentBookings = orders.filter(o => {
                    const orderDate = new Date(o.date || '');
                    return orderDate >= sevenDaysAgo && orderDate <= today;
                }).length;
                document.getElementById('recentBookingsCount').textContent = recentBookings;
            }

        // Form handlers
        document.getElementById('addUserForm').addEventListener('submit', function(e){
            e.preventDefault();
            const name = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const role = document.getElementById('newUserRole').value;
            const id = window.moodCafeAdmin.addUser({ name, email, role, joinDate: new Date().toISOString().split('T')[0], status:'active' });
            closeAddUserModal();
            renderUsersTable();
            updateStats();
            showToast('User added (simulated)', 'success');
        });

        document.getElementById('addMenuItemForm').addEventListener('submit', function(e){
            e.preventDefault();
            const name = document.getElementById('menuItemName').value.trim();
            const desc = document.getElementById('menuItemDesc').value.trim();
            const price = Number(document.getElementById('menuItemPrice').value) || 0;
            const category = document.getElementById('menuItemCategory').value;
            const fileInput = document.getElementById('menuItemPhoto');
            if (fileInput.files && fileInput.files[0]){
                const reader = new FileReader();
                reader.onload = function(ev){
                    const photo = ev.target.result;
                    window.moodCafeAdmin.addMenuItem({ name, description: desc, price, category, photo, orders:0 });
                    closeAddMenuItemModal();
                    renderMenuGrid();
                    updateMenuStats();
                    showToast('Menu item added (simulated)', 'success');
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                window.moodCafeAdmin.addMenuItem({ name, description: desc, price, category, photo: '', orders:0 });
                closeAddMenuItemModal();
                renderMenuGrid();
                updateMenuStats();
                showToast('Menu item added (simulated)', 'success');
            }
        });

        document.getElementById('addOrderForm').addEventListener('submit', function(e){
            e.preventDefault();
            const user = document.getElementById('orderUser').value.trim();
            const total = Number(document.getElementById('orderAmount').value) || 0;
            const date = document.getElementById('orderDate').value;
            const status = document.getElementById('orderStatus').value;
            const id = window.moodCafeAdmin.addOrder({ user, total, date, status });
            closeAddOrderModal();
            renderOrdersTable();
            updateStats();
                updateBookingStats();
            showToast('Transaction recorded (simulated)', 'success');
        });

        // React to data changes
        window.addEventListener('moodCafeAdminUpdate', function(e){
            // simple refresh
            renderUsersTable();
            renderMenuGrid();
            renderOrdersTable();
            updateMenuStats();
            updateStats();
                updateBookingStats();
        });

        // Initial render helpers when admin loads
        (function(){
            renderUsersTable();
            renderMenuGrid();
            renderOrdersTable();
                updateBookingStats();
        })();
    </script>
</body>
</html>
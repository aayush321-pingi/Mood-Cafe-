<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MoodBox Caf√© ‚Äî Static Preview</title>

  <!-- Tailwind Play CDN for quick local preview (not for production) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Admin Control System -->
  <script src="adminControl.js"></script>
  <!-- Monitoring System -->
  <script src="monitoring.js"></script>
  <!-- Booking Manager -->
  <script src="js/bookingManager.js"></script>

  <style>
    /* Custom animations to mimic framer-motion behavior */
    /* Dashboard animations */
    @keyframes slideDown {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideRight {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .dashboard-header { animation: slideDown 0.5s ease-out; }
    .stats-card { animation: slideDown 0.5s ease-out; }
    .stats-card:nth-child(1) { animation-delay: 0.1s; }
    .stats-card:nth-child(2) { animation-delay: 0.2s; }
    .stats-card:nth-child(3) { animation-delay: 0.3s; }
    .stats-card:nth-child(4) { animation-delay: 0.4s; }
    .membership-card { animation: slideDown 0.5s ease-out 0.5s both; }
    .booking-card { animation: slideRight 0.5s ease-out both; }
    .activity-card { animation: slideRight 0.5s ease-out both; }

    /* Original animations */
    @keyframes bg-scale-rotate {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.06) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    .bg-animated {
      animation: bg-scale-rotate 20s ease-in-out infinite;
      transform-origin: center;
      opacity: 0.18;
    }

    @keyframes float {
      0% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0); }
    }
    .float-slow { animation: float 3s ease-in-out infinite; }

    @keyframes bounce {
      0% { transform: translateY(0); }
      50% { transform: translateY(12px); }
      100% { transform: translateY(0); }
    }
    .bounce { animation: bounce 1.5s infinite ease-in-out; }

    /* Small utility for emoji icon circle */
    .emoji-circle {
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:1rem;
      width:64px;
      height:64px;
      font-size:28px;
      box-shadow: inset 0 0 40px rgba(255,255,255,0.03);
    }

    /* subtle backdrop to image card */
    .image-overlay {
      background: linear-gradient(180deg, rgba(2,6,23,0.0) 20%, rgba(2,6,23,0.85) 100%);
    }

    /* simple chat area */
    .chat-box { background: rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); padding:1rem; border-radius:12px; max-width:720px; }
    .message { padding:.5rem .75rem; border-radius:10px; margin-bottom:.5rem; max-width:80%; }
    .message.user { background: rgba(99,102,241,0.12); color: white; margin-left:auto; }
    .message.bot { background: rgba(255,255,255,0.03); color: #e6e6e6; }
  </style>
</head>
<body class="bg-slate-950 text-white antialiased">

  <div class="min-h-screen">

    <!-- Top Navigation (dynamic page-like nav) -->
    <nav id="topNav" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-slate-900/60 backdrop-blur-md border border-white/6 rounded-full px-3 py-2 shadow-lg" style="z-index:100002; pointer-events:auto;">
      <div class="flex items-center gap-1">
        <button type="button" data-target="hero" class="navBtn px-4 py-2 text-sm rounded-full text-gray-300 hover:text-white hover:bg-white/5">Home</button>
  <button type="button" data-target="menu" class="navBtn px-4 py-2 text-sm rounded-full text-gray-300 hover:text-white hover:bg-white/5">Menu</button>
        <button type="button" data-target="zones" class="navBtn px-4 py-2 text-sm rounded-full text-gray-300 hover:text-white hover:bg-white/5">Zones</button>
        <button type="button" data-target="events" class="navBtn px-4 py-2 text-sm rounded-full text-gray-300 hover:text-white hover:bg-white/5">Events</button>
        <button type="button" data-target="gallery" class="navBtn px-4 py-2 text-sm rounded-full text-gray-300 hover:text-white hover:bg-white/5">Gallery</button>
        <button id="profileBtn" onclick="window.location.href='dashboard.html'" class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center ml-2 hover:bg-purple-700 transition-colors">
          <span id="userInitials" class="text-sm font-medium">AA</span>
        </button>
      </div>
    </nav>

    <!-- Debug: Simulate booking (visible for local testing) -->
    <div id="devTools" style="position:fixed;left:12px;bottom:12px;z-index:99999;">
      <button id="simulateBookingBtn" class="hidden px-3 py-2 bg-amber-500 text-black rounded" title="Simulate booking">Simulate Booking</button>
    </div>

    <!-- Hero Section -->
    <section class="relative h-screen flex items-center justify-center overflow-hidden">
      <div class="absolute inset-0">
        <!-- background layers should not capture pointer events -->
        <div class="absolute inset-0 bg-gradient-to-br from-purple-900/40 via-pink-900/40 to-amber-900/40 pointer-events-none"></div>
        <div class="absolute inset-0 bg-cover bg-center bg-animated pointer-events-none" style="background-image:url('https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=1600');"></div>
      </div>

      <div class="relative z-10 text-center px-4 max-w-5xl mx-auto">
        <div class="mb-6">
          <div class="inline-block mb-6 float-slow">
            <div class="w-20 h-20 rounded-full bg-amber-400/10 flex items-center justify-center">
              <span class="text-amber-300 text-4xl">‚ú®</span>
            </div>
          </div>

          <h1 class="text-5xl md:text-6xl font-bold mb-6 leading-tight">
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-purple-400 via-pink-400 to-amber-400">
              Experience Your Mood
            </span>
          </h1>

          <p class="text-xl md:text-2xl text-gray-300 mb-8 max-w-3xl mx-auto">
            Where technology meets emotion. Discover mood-based menus, immersive zones,
            and unforgettable experiences at MoodBox Caf√©.
          </p>

          <div class="flex flex-col sm:flex-row gap-4 justify-center">
            <a href="#zones" class="inline-flex items-center">
              <button class="px-8 py-6 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-lg rounded-lg flex items-center gap-3">
                Book Your Experience
                <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7"/></svg>
              </button>
            </a>

              <button id="heroExploreMenu" class="px-8 py-6 border border-purple-500/30 text-purple-300 hover:bg-purple-600/20 rounded-lg text-lg">
                Explore Menu
              </button>
          </div>
        </div>
      </div>

      <!-- Scroll Indicator -->
      <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2">
        <div class="w-6 h-10 border-2 border-purple-400 rounded-full flex items-start justify-center p-2">
          <div class="w-1 h-2 bg-purple-400 rounded-full bounce"></div>
        </div>
      </div>
    </section>

    <!-- Mood Categories -->
  <section class="py-20 px-4" id="menu">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Choose Your Mood</h2>
          <p class="text-xl text-gray-400">Curated experiences tailored to how you feel</p>
            <div class="mt-6">
              <button id="menuSectionExploreBtn" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg">Explore Menu</button>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <!-- Energize -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-yellow-500 to-orange-500">
                <span>‚ö°</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Energize</h3>
              <p class="text-sm text-gray-400">Boost your day</p>
            </div>
          </div>

          <!-- Relax -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-blue-500 to-cyan-500">
                <span>üßò</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Relax</h3>
              <p class="text-sm text-gray-400">Unwind & chill</p>
            </div>
          </div>

          <!-- Romance -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-pink-500 to-rose-500">
                <span>üíñ</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Romance</h3>
              <p class="text-sm text-gray-400">Intimate moments</p>
            </div>
          </div>

          <!-- Focus -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-purple-500 to-indigo-500">
                <span>‚òï</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Focus</h3>
              <p class="text-sm text-gray-400">Get work done</p>
            </div>
          </div>

          <!-- Social -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-green-500 to-emerald-500">
                <span>üë•</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Social</h3>
              <p class="text-sm text-gray-400">Connect & share</p>
            </div>
          </div>

          <!-- Play -->
          <div class="p-6 cursor-pointer group">
            <div class="card p-6 text-center bg-white/5 border border-white/6 rounded-xl transition-all hover:bg-white/8">
              <div class="mx-auto mb-4 emoji-circle bg-gradient-to-br from-red-500 to-pink-500">
                <span>üéÆ</span>
              </div>
              <h3 class="text-white font-semibold mb-1">Play</h3>
              <p class="text-sm text-gray-400">Game time</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Menu Page (converted from React MenuPage) -->
  <section id="menu-page" class="py-20 px-4 bg-white/2">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-8">
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">Mood-Based Menu</h2>
          <p class="text-lg text-gray-400">Every dish crafted to match your emotion</p>
        </div>

        <!-- Search -->
        <div class="max-w-2xl mx-auto mb-6 relative">
          <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input id="menuSearch" class="pl-12 bg-white/5 border border-white/10 text-white placeholder:text-gray-500 h-14 text-lg w-full rounded-lg" placeholder="Search menu items..." />
        </div>

        <!-- Mood Filters -->
        <div class="mb-6">
          <h3 class="text-white font-semibold mb-3 flex items-center gap-2">‚ú® Filter by Mood</h3>
          <div id="moodFilters" class="flex flex-wrap gap-3"></div>
        </div>

        <!-- Category Tabs -->
        <div class="mb-8">
          <div id="categoryTabs" class="inline-flex bg-white/5 border border-white/10 rounded-lg overflow-hidden"></div>
        </div>

        <!-- Menu CTA (hidden grid until explore clicked) -->
        <div id="menuCta" class="max-w-xl mx-auto text-center py-12">
          <p class="text-gray-300 mb-6">Our curated dishes are ready ‚Äî explore the full mood-based menu.</p>
          <button id="exploreMenuBtn" class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-lg">Explore Full Menu</button>
        </div>

        <!-- Menu Grid (initially hidden) -->
        <div id="menuGrid" class="hidden grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </section>

    <!-- Featured Zones -->
    <section class="py-20 px-4 bg-white/5" id="zones">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Immersive Zones</h2>
          <p class="text-xl text-gray-400">Discover spaces designed for every experience</p>
        </div>

        <div class="grid md:grid-cols-2 gap-8">
          <!-- Zone 1 -->
          <a href="#zones" class="group">
            <div class="overflow-hidden bg-white/5 border border-white/10 rounded-xl">
              <div class="relative h-64 overflow-hidden">
                <img src="https://images.unsplash.com/photo-1517457373958-b7bdd4587205?w=1200" alt="Couple Pods" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                <div class="absolute inset-0 image-overlay"></div>
                <div class="absolute top-4 right-4 bg-white/10 p-3 rounded-xl">
                  <span>üíñ</span>
                </div>
              </div>
              <div class="p-6">
                <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-purple-400 transition-colors">Couple Pods</h3>
                <p class="text-gray-400">Private, intimate spaces with mood lighting and personalized ambiance</p>
              </div>
            </div>
          </a>

          <!-- Zone 2 -->
          <a href="#zones" class="group">
            <div class="overflow-hidden bg-white/5 border border-white/10 rounded-xl">
              <div class="relative h-64 overflow-hidden">
                <img src="https://images.unsplash.com/photo-1497366754035-f200968a6e72?w=1200" alt="Silent Pods" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                <div class="absolute inset-0 image-overlay"></div>
                <div class="absolute top-4 right-4 bg-white/10 p-3 rounded-xl">
                  <span>üîï</span>
                </div>
              </div>
              <div class="p-6">
                <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-purple-400 transition-colors">Silent Pods</h3>
                <p class="text-gray-400">Noise-free sanctuary for work, study, or meditation</p>
              </div>
            </div>
          </a>

          <!-- Zone 3 -->
          <a href="#zones" class="group">
            <div class="overflow-hidden bg-white/5 border border-white/10 rounded-xl">
              <div class="relative h-64 overflow-hidden">
                <img src="https://images.unsplash.com/photo-1415369629372-26f2fe60c467?w=1200" alt="Pet Zone" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                <div class="absolute inset-0 image-overlay"></div>
                <div class="absolute top-4 right-4 bg-white/10 p-3 rounded-xl">
                  <span>üêæ</span>
                </div>
              </div>
              <div class="p-6">
                <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-purple-400 transition-colors">Pet Zone</h3>
                <p class="text-gray-400">Spend quality time with our friendly caf√© pets</p>
              </div>
            </div>
          </a>

          <!-- Zone 4 -->
          <a href="#zones" class="group">
            <div class="overflow-hidden bg-white/5 border border-white/10 rounded-xl">
              <div class="relative h-64 overflow-hidden">
                <img src="https://images.unsplash.com/photo-1511512578047-dfb367046420?w=1200" alt="Game Arena" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                <div class="absolute inset-0 image-overlay"></div>
                <div class="absolute top-4 right-4 bg-white/10 p-3 rounded-xl">
                  <span>üéÆ</span>
                </div>
              </div>
              <div class="p-6">
                <h3 class="text-2xl font-bold text-white mb-2 group-hover:text-purple-400 transition-colors">Game Arena</h3>
                <p class="text-gray-400">Immersive gaming with LED smart tables and interactive tech</p>
              </div>
            </div>
          </a>
        </div>

        <div class="text-center mt-12">
          <a href="#zones">
            <button id="exploreZonesBtn" class="px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg">Explore All Zones</button>
            <button id="openAdvisorBtn" class="ml-4 px-6 py-4 border border-white/10 text-purple-300 rounded-lg">Open Mood Advisor</button>
          </a>
        </div>

        <!-- Bookable Zones Grid (loaded from BookingManager) -->
        <div class="mt-16 pt-12 border-t border-white/10">
          <h3 class="text-2xl font-bold text-white mb-8">Book Your Zone Now</h3>
          <div id="zoneBookingGrid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Zones will be populated by JS -->
          </div>
        </div>
      </div>
    </section>

    <!-- Zone Booking Modal -->
    <div id="zoneBookingModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 p-8 rounded-lg w-full max-w-md max-h-screen overflow-y-auto" role="dialog" aria-modal="true" aria-labelledby="bookingTitle">
        <div class="flex items-center justify-between mb-4">
          <h3 id="bookingTitle" class="text-xl font-semibold">Book a Zone</h3>
          <button id="closeBookingBtn" onclick="closeZoneBooking()" class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <form id="zoneBookingForm" class="space-y-3">
          <div>
            <label class="text-sm text-gray-300">Zone</label>
            <div id="bookingZoneName" class="p-2 rounded bg-gray-700 text-white font-semibold"></div>
          </div>
          <div>
            <label class="text-sm text-gray-300">Your Name</label>
            <input id="bookingName" class="w-full p-2 rounded bg-gray-700" placeholder="Full name" required />
          </div>
          <div>
            <label class="text-sm text-gray-300">Email</label>
            <input id="bookingEmail" class="w-full p-2 rounded bg-gray-700" type="email" placeholder="Email" required />
          </div>
          <div class="grid grid-cols-2 gap-2">
            <div>
              <label class="text-sm text-gray-300">Date</label>
              <input id="bookingDate" class="w-full p-2 rounded bg-gray-700" type="date" required />
            </div>
            <div>
              <label class="text-sm text-gray-300">Time</label>
              <input id="bookingTime" class="w-full p-2 rounded bg-gray-700" type="time" required />
            </div>
          </div>
          <div>
            <label class="text-sm text-gray-300">Number of Seats</label>
            <input id="bookingSeats" class="w-full p-2 rounded bg-gray-700" type="number" min="1" max="6" value="1" required />
          </div>
          <div id="bookingPrice" class="text-sm text-gray-300">Total: ‚Çπ<span id="totalPrice">0</span></div>
          <div class="flex justify-end gap-2 pt-4">
            <button type="button" onclick="closeZoneBooking()" class="px-3 py-2 rounded bg-gray-700">Cancel</button>
            <button type="submit" class="px-3 py-2 rounded bg-purple-600">Confirm Booking</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Event Booking Modal -->
    <div id="eventBookingModal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center z-50 p-4">
      <div class="bg-gray-800 p-8 rounded-lg w-full max-w-md" role="dialog" aria-modal="true" aria-labelledby="eventBookingTitle">
        <div class="flex items-center justify-between mb-4">
          <h3 id="eventBookingTitle" class="text-xl font-semibold">Book Event Tickets</h3>
          <button id="closeEventBookingBtn" onclick="closeEventBooking()" class="text-gray-400 hover:text-white">‚úï</button>
        </div>
        <form id="eventBookingForm" class="space-y-3">
          <div>
            <label class="text-sm text-gray-300">Event</label>
            <div id="bookingEventName" class="p-2 rounded bg-gray-700 text-white font-semibold"></div>
          </div>
          <div>
            <label class="text-sm text-gray-300">Your Name</label>
            <input id="eventBookingName" class="w-full p-2 rounded bg-gray-700" placeholder="Full name" required />
          </div>
          <div>
            <label class="text-sm text-gray-300">Email</label>
            <input id="eventBookingEmail" class="w-full p-2 rounded bg-gray-700" type="email" placeholder="Email" required />
          </div>
          <div>
            <label class="text-sm text-gray-300">Number of Tickets</label>
            <input id="eventBookingTickets" class="w-full p-2 rounded bg-gray-700" type="number" min="1" max="10" value="1" required />
          </div>
          <div id="eventBookingPrice" class="text-sm text-gray-300">Total: ‚Çπ<span id="eventTotalPrice">0</span></div>
          <div class="flex justify-end gap-2 pt-4">
            <button type="button" onclick="closeEventBooking()" class="px-3 py-2 rounded bg-gray-700">Cancel</button>
            <button type="submit" class="px-3 py-2 rounded bg-purple-600">Book Now</button>
          </div>
        </form>
      </div>
    </div>

    <!-- IFrame modal for Mood Advisor -->
    <div id="zonesIframeModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/70 p-4">
      <div class="w-full max-w-5xl h-[80vh] bg-transparent relative rounded-lg overflow-hidden">
        <button id="closeZonesIframe" class="absolute top-3 right-3 z-60 bg-white/5 text-white rounded-full p-2">‚úï</button>
        <iframe id="zonesIframe" src="zones.html" class="w-full h-full bg-white/5 border border-white/10 rounded-lg" frameborder="0" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
      </div>
    </div>

    <!-- Booking Confirmation Modal -->
    <div id="bookingConfirmationModal" class="fixed inset-0 z-60 hidden items-center justify-center bg-black/70 p-4">
      <div class="bg-gray-900 p-6 rounded-lg w-full max-w-sm text-center" role="dialog" aria-modal="true" aria-labelledby="confirmTitle">
        <h3 id="confirmTitle" class="text-lg font-semibold mb-2">Booking Confirmed</h3>
        <p class="text-sm text-gray-300 mb-4">Your booking reference:</p>
        <div id="confirmRef" class="bg-gray-800 p-3 rounded mb-4 font-mono text-sm"></div>
        <div class="flex gap-2 justify-center">
          <button id="copyRefBtn" class="px-3 py-2 bg-gray-700 rounded">Copy Reference</button>
          <button id="closeConfirmBtn" class="px-3 py-2 bg-purple-600 rounded">Close</button>
        </div>
      </div>
    </div>

  <!-- Featured Events (static placeholders) -->
  <section id="events" class="py-20 px-4">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-16">
          <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Upcoming Events</h2>
          <p class="text-xl text-gray-400">Don't miss our special experiences</p>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-white/5 border border-white/10 p-6 rounded-xl">
            <img src="https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200" alt="Live Jazz Night" class="w-full h-48 object-cover rounded-lg mb-4" />
            <div class="flex items-center gap-2 text-purple-400 mb-3">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 21h14"/></svg>
              <span class="text-sm">Nov 21, 2025</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Live Jazz Night</h3>
            <p class="text-gray-400 text-sm mb-4">An evening of smooth tunes paired with signature blends.</p>
            <button class="w-full py-2 border border-purple-500/40 text-purple-300 rounded" data-event-book="e1">Book Now</button>
          </div>

          <div class="bg-white/5 border border-white/10 p-6 rounded-xl">
            <img src="https://images.unsplash.com/photo-1542856391-6f4d3ed3e9d6?w=1200" alt="Board Game Tournament" class="w-full h-48 object-cover rounded-lg mb-4" />
            <div class="flex items-center gap-2 text-purple-400 mb-3">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 21h14"/></svg>
              <span class="text-sm">Dec 02, 2025</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Board Game Tournament</h3>
            <p class="text-gray-400 text-sm mb-4">Compete, laugh, and win caf√© credits.</p>
            <button class="w-full py-2 border border-purple-500/40 text-purple-300 rounded" data-event-book="e2">Book Now</button>
          </div>

          <div class="bg-white/5 border border-white/10 p-6 rounded-xl">
            <img src="https://images.unsplash.com/photo-1527766833261-b09c3163a791?w=1200" alt="Latte Art Workshop" class="w-full h-48 object-cover rounded-lg mb-4" />
            <div class="flex items-center gap-2 text-purple-400 mb-3">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M3 11h18M5 21h14"/></svg>
              <span class="text-sm">Dec 15, 2025</span>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Latte Art Workshop</h3>
            <p class="text-gray-400 text-sm mb-4">Hands-on session to craft beautiful lattes.</p>
            <a href="#events"><button class="w-full py-2 border border-purple-500/40 text-purple-300 rounded">Learn More</button></a>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-20 px-4">
      <div class="max-w-4xl mx-auto">
        <div class="relative overflow-hidden rounded-3xl">
          <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 opacity-90"></div>
          <div class="relative p-12 text-center">
            <div class="mx-auto mb-6"><span class="text-amber-300 text-5xl">‚≠ê</span></div>
            <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Join Our Loyalty Program</h2>
            <p class="text-xl text-white/90 mb-8">Earn points, unlock exclusive experiences, and get special rewards</p>
            <button id="signupBtn" class="px-6 py-3 bg-white text-purple-600 rounded-lg">Sign Up Now</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Gallery Section (converted from React GalleryPage) -->
    <section id="gallery" class="py-20 px-4">
      <div class="max-w-7xl mx-auto">
        <div class="text-center mb-12">
          <h1 class="text-4xl md:text-6xl font-bold text-white mb-4">Gallery</h1>
          <p class="text-xl text-gray-400">Explore the MoodBox experience through images</p>
        </div>

        <!-- Category Filter -->
        <div class="mb-12">
          <div id="galleryTabs" class="inline-flex bg-white/5 border border-white/10 rounded-lg overflow-hidden"></div>
        </div>

        <!-- Masonry Gallery Grid -->
        <div id="galleryGrid" class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6"></div>
      </div>
    </section>

    <!-- AI Components (placeholders) -->
    <section class="py-12 px-4">
      <div class="max-w-7xl mx-auto grid md:grid-cols-2 gap-8">
        <!-- Mood Advisor -->
        <div class="chat-box">
          <h3 class="text-2xl font-bold mb-3">Mood Advisor</h3>
          <p class="text-gray-400 mb-4">Select your mood and get a suggested menu or zone.</p>

          <div class="grid grid-cols-2 gap-3 mb-4">
            <button class="py-2 rounded bg-purple-600" data-mood="Energize">Energize</button>
            <button class="py-2 rounded bg-blue-600" data-mood="Relax">Relax</button>
            <button class="py-2 rounded bg-pink-600" data-mood="Romance">Romance</button>
            <button class="py-2 rounded bg-green-600" data-mood="Social">Social</button>
          </div>

          <div id="moodAdvice" class="text-gray-200">Choose a mood to get tailored suggestions.</div>
        </div>

        <!-- Smart Chatbot -->
        <div class="chat-box">
          <h3 class="text-2xl font-bold mb-3">Smart Chatbot</h3>
          <div id="chatLog" style="height:260px; overflow:auto; padding:0.5rem; border-radius:8px; background:rgba(0,0,0,0.2); margin-bottom:0.75rem;">
            <div class="message bot">Hi! I'm MoodBox Assistant. Ask me about events, zones, or menu suggestions.</div>
          </div>

          <div class="flex gap-2">
            <input id="chatInput" type="text" placeholder="Ask a question..." class="flex-1 px-3 py-2 rounded bg-white/5 border border-white/6 text-white" />
            <button id="sendBtn" class="px-4 py-2 bg-purple-600 rounded">Send</button>
          </div>
        </div>
      </div>
    </section>

    <footer class="py-8 text-center text-gray-400">
      ¬© MoodBox Caf√© ‚Äî Static Preview (not connected to live APIs)
    </footer>
  </div>

  <script>
    // Simple interactions

    // Toast system for non-blocking notifications
    (function(){
      const container = document.createElement('div'); container.id='toastContainer'; container.className='fixed right-4 bottom-6 z-60 space-y-2 w-96'; document.body.appendChild(container);
      window.showToast = function(message, type='info', timeout=3500){
        const t = document.createElement('div');
        t.className = `p-3 rounded-lg shadow-lg text-sm ${type==='error'? 'bg-red-600' : type==='success'? 'bg-green-600' : 'bg-gray-800'} text-white`;
        t.setAttribute('role','status'); t.innerText = message;
        container.appendChild(t);
        setTimeout(()=>{ t.classList.add('opacity-0'); setTimeout(()=>t.remove(),400); }, timeout);
      };
    })();

    // Signup button (simulates redirectToLogin)
    document.getElementById('signupBtn').addEventListener('click', () => {
      showToast('This static preview cannot perform authentication. In your app, call base44.auth.redirectToLogin() here.', 'info');
    });

    // Mood advisor: simple static suggestions
    const moodButtons = document.querySelectorAll('[data-mood]');
    const advice = {
      'Energize': 'Try our Citrus Espresso and the High-Energy Playlist in the Game Arena.',
      'Relax': 'We recommend the Lavender Latte and a Silent Pod with soft ambient lighting.',
      'Romance': 'Share a Chocolate Fondue and book a Couple Pod with soft pink lighting.',
      'Social': 'Order our Group Tasting Platter and reserve a Social Table.',
      'Focus': 'Grab a Nitro Cold Brew and settle into a Silent Pod with a desk lamp.',
      'Play': 'Get a Gaming Combo and head to the Game Arena for tournaments.'
    };
    const moodAdviceEl = document.getElementById('moodAdvice');

    moodButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const m = btn.getAttribute('data-mood');
        moodAdviceEl.textContent = advice[m] || 'Try exploring our menu and zones for a custom experience.';
      });
    });

    // Basic chat echo behavior (placeholder for SmartChatbot)
    const chatLog = document.getElementById('chatLog');
    const chatInput = document.getElementById('chatInput');
    const sendBtn = document.getElementById('sendBtn');

    function appendMessage(text, who='bot') {
      const div = document.createElement('div');
      div.className = 'message ' + (who === 'user' ? 'user' : 'bot');
      div.textContent = text;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    sendBtn.addEventListener('click', () => {
      const val = chatInput.value.trim();
      if (!val) return;
      appendMessage(val, 'user');
      chatInput.value = '';
      // A very small simulated "AI" response (placeholder)
      setTimeout(() => {
        // canned responses for some keywords:
        const q = val.toLowerCase();
        if (q.includes('events')) appendMessage('We have Live Jazz Night (Nov 21), Board Game Tournament (Dec 02), and Latte Art Workshop (Dec 15).');
        else if (q.includes('zones')) appendMessage('We offer Couple Pods, Silent Pods, Pet Zone, and Game Arena. Which would you like to learn about?');
        else if (q.includes('menu')) appendMessage('Try our Lavender Latte, Nitro Cold Brew, or the Citrus Espresso. We also have seasonal pastries.');
        else appendMessage('Great question! In the full app I would query the backend and return a richer answer. This demo simply echoes keywords.');
      }, 700);
    });

    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendBtn.click();
    });

    /* ---------------------- Gallery Page Logic ---------------------- */
    (function(){
      // Gallery data (converted from React array)
      const galleryImages = [
        { id:1, url:'https://images.unsplash.com/photo-1517457373958-b7bdd4587205', category:'couple_pods', title:'Intimate Couple Pod', description:'Private romantic spaces with ambient lighting' },
        { id:2, url:'https://images.unsplash.com/photo-1554118811-1e0d58224f24', category:'ambiance', title:'Mood Lighting', description:'Carefully crafted atmospheric experiences' },
        { id:3, url:'https://images.unsplash.com/photo-1415369629372-26f2fe60c467', category:'pet_zone', title:'Pet Caf√©', description:'Friendly companions for your caf√© experience' },
        { id:4, url:'https://images.unsplash.com/photo-1511512578047-dfb367046420', category:'game_zone', title:'Gaming Arena', description:'State-of-the-art gaming setups' },
        { id:5, url:'https://images.unsplash.com/photo-1497366754035-f200968a6e72', category:'silent_pods', title:'Silent Work Pod', description:'Peaceful spaces for focus and productivity' },
        { id:6, url:'https://images.unsplash.com/photo-1509042239860-f550ce710b93', category:'menu', title:'Artisan Coffee', description:'Expertly crafted beverages' },
        { id:7, url:'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085', category:'ambiance', title:'Cozy Atmosphere', description:'Warm and welcoming interiors' },
        { id:8, url:'https://images.unsplash.com/photo-1559056199-641a0ac8b55e', category:'menu', title:'Gourmet Delights', description:'Mood-inspired culinary creations' },
        { id:9, url:'https://images.unsplash.com/photo-1481349518771-20055b2a7b24', category:'ambiance', title:'Modern Design', description:'Contemporary caf√© aesthetics' },
        { id:10, url:'https://images.unsplash.com/photo-1516450360452-9312f5e86fc7', category:'tech', title:'Smart Tables', description:'Interactive LED technology' },
        { id:11, url:'https://images.unsplash.com/photo-1514933651103-005eec06c04b', category:'menu', title:'Fresh Pastries', description:'Daily baked treats' },
        { id:12, url:'https://images.unsplash.com/photo-1545665225-b23b99e4d45e', category:'pet_zone', title:'Furry Friends', description:'Adorable caf√© companions' }
      ];

      const categories = [
        { value:'all', label:'All' },
        { value:'couple_pods', label:'Couple Pods' },
        { value:'pet_zone', label:'Pet Zone' },
        { value:'game_zone', label:'Game Zone' },
        { value:'silent_pods', label:'Silent Pods' },
        { value:'menu', label:'Menu' },
        { value:'ambiance', label:'Ambiance' },
        { value:'tech', label:'Tech' }
      ];

      const tabsEl = document.getElementById('galleryTabs');
      const gridEl = document.getElementById('galleryGrid');
      let selectedCategory = 'all';

      function galleryEscape(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

      function renderTabs(){
        tabsEl.innerHTML = '';
        categories.forEach(cat => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = cat.value === selectedCategory ? 'px-4 py-2 bg-purple-600 text-white' : 'px-4 py-2 text-gray-300';
          btn.textContent = cat.label;
          btn.addEventListener('click', ()=>{ selectedCategory = cat.value; renderTabs(); renderGrid(); });
          tabsEl.appendChild(btn);
        });
      }

      function renderGrid(){
        gridEl.innerHTML = '';
        const list = selectedCategory === 'all' ? galleryImages : galleryImages.filter(i=>i.category===selectedCategory);
        if(list.length===0){ gridEl.innerHTML = '<div class="text-center py-12 col-span-full text-gray-400">No images found.</div>'; return; }
        list.forEach((img, idx) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'break-inside-avoid';
          wrapper.innerHTML = `
            <div class="group relative overflow-hidden bg-white/5 border-white/10 hover:border-purple-500/50 cursor-pointer transition-all rounded-lg">
              <img src="${galleryEscape(img.url)}" alt="${galleryEscape(img.title)}" class="w-full h-auto group-hover:scale-110 transition-transform duration-500" />
              <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
              <div class="absolute bottom-0 left-0 right-0 p-4 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                <h3 class="text-white font-bold text-lg">${galleryEscape(img.title)}</h3>
                <p class="text-gray-300 text-sm">${galleryEscape(img.description)}</p>
              </div>
            </div>
          `;
          // click to open lightbox
          wrapper.addEventListener('click', ()=> openLightbox(img));
          gridEl.appendChild(wrapper);
        });
      }

      // Lightbox modal
      const lightboxHtml = `
        <div id="galleryLightbox" class="fixed inset-0 z-60 hidden items-center justify-center bg-black/95 backdrop-blur-sm p-4">
          <div class="max-w-5xl w-full relative">
            <button id="lightboxClose" class="absolute top-4 right-4 text-white bg-white/5 rounded-full p-2">‚úï</button>
            <img id="lightboxImg" src="" alt="" class="w-full h-auto rounded-2xl shadow-2xl" />
            <div id="lightboxCaption" class="mt-6 text-center text-gray-300"></div>
          </div>
        </div>
      `;
      document.body.insertAdjacentHTML('beforeend', lightboxHtml);
      const lightbox = document.getElementById('galleryLightbox');
      const lightboxImg = document.getElementById('lightboxImg');
      const lightboxCaption = document.getElementById('lightboxCaption');
      const lightboxClose = document.getElementById('lightboxClose');

      function openLightbox(img){
        lightboxImg.src = img.url + '?w=1600';
        lightboxImg.alt = img.title;
        lightboxCaption.innerHTML = `<h3 class="text-2xl font-bold text-white mb-2">${galleryEscape(img.title)}</h3><p class="text-gray-400">${galleryEscape(img.description)}</p>`;
        lightbox.classList.remove('hidden'); lightbox.classList.add('flex');
      }
      function closeLightbox(){ lightbox.classList.remove('flex'); lightbox.classList.add('hidden'); lightboxImg.src = ''; }
      lightboxClose.addEventListener('click', closeLightbox);
      lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox) closeLightbox(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeLightbox(); });

      // initial render
      renderTabs(); renderGrid();
      window.__galleryDebug = { renderGrid };
    })();

    /* ---------------------- Menu Page Logic ---------------------- */
    (function() {
      // State
      let menuItems = [];
      let filteredItems = [];
      let loadingMenu = true;
      let selectedMood = 'all';
      let selectedCategory = 'all';
      let searchQuery = '';

      const moods = ['all','energize','relax','focus','romance','social','comfort'];
      const categories = ['all','beverages','food','desserts','specials'];

      const moodColors = {
        energize: 'from-yellow-500 to-orange-500',
        relax: 'from-blue-500 to-cyan-500',
        focus: 'from-purple-500 to-indigo-500',
        romance: 'from-pink-500 to-rose-500',
        social: 'from-green-500 to-emerald-500',
        comfort: 'from-amber-500 to-yellow-500'
      };

      const moodEmoji = {
        energize: '‚ö°', relax: 'üßò', focus: 'üß†', romance: 'üíñ', social: 'üë•', comfort: '‚òï'
      };

      const menuGrid = document.getElementById('menuGrid');
      const moodFiltersEl = document.getElementById('moodFilters');
      const categoryTabsEl = document.getElementById('categoryTabs');
      const searchInput = document.getElementById('menuSearch');

      // Sample static menu items (replace with API fetch in real app)
      const sampleMenu = [
        { id: 1, name: 'Citrus Espresso', description: 'Bright espresso with citrus notes.', image_url: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?w=1200', mood_tag: 'energize', category: 'beverages', price: 3.5, dietary_info: ['vegan'] },
        { id: 2, name: 'Lavender Latte', description: 'Calming lavender-infused latte.', image_url: 'https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=1200', mood_tag: 'relax', category: 'beverages', price: 4.25, dietary_info: ['vegetarian'] },
        { id: 3, name: 'Chocolate Fondue', description: 'Shareable rich chocolate with fruit.', image_url: 'https://images.unsplash.com/photo-1529042410759-befb1204b468?w=1200', mood_tag: 'romance', category: 'desserts', price: 8.0, dietary_info: [] },
        { id: 4, name: 'Nitro Cold Brew', description: 'Smooth cold brew with a creamy texture.', image_url: 'https://images.unsplash.com/photo-1510627498534-cf7e9002facc?w=1200', mood_tag: 'focus', category: 'beverages', price: 4.75, dietary_info: ['vegan'] },
        { id: 5, name: 'Group Tasting Platter', description: 'A selection of snacks for sharing.', image_url: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200', mood_tag: 'social', category: 'food', price: 15.0, dietary_info: ['gluten-free'] },
        { id: 6, name: 'Gaming Combo', description: 'Energy snacks for long gaming sessions.', image_url: 'https://images.unsplash.com/photo-1544025162-d76694265947?w=1200', mood_tag: 'comfort', category: 'specials', price: 9.5, dietary_info: [] }
      ];

      // Render mood filter buttons
      function renderMoodFilters() {
        moodFiltersEl.innerHTML = '';
        moods.forEach(m => {
          const btn = document.createElement('button');
          btn.type = 'button';
          const isActive = selectedMood === m;
          btn.className = isActive
            ? `px-4 py-2 rounded-lg text-white border-0 bg-gradient-to-r ${m !== 'all' ? moodColors[m] : 'from-purple-600 to-pink-600'}`
            : 'px-4 py-2 rounded-lg bg-white/5 border border-white/10 text-gray-300 hover:bg-white/10';
          btn.textContent = m.charAt(0).toUpperCase() + m.slice(1);
          btn.addEventListener('click', () => { selectedMood = m; renderMoodFilters(); filterAndRender(); });
          moodFiltersEl.appendChild(btn);
        });
      }

      // Render category tabs
      function renderCategoryTabs() {
        categoryTabsEl.innerHTML = '';
        categories.forEach(cat => {
          const btn = document.createElement('button');
          btn.type = 'button';
          const isActive = selectedCategory === cat;
          btn.className = 'px-4 py-2 text-sm ' + (isActive ? 'bg-purple-600 text-white' : 'text-gray-300');
          btn.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
          btn.addEventListener('click', () => { selectedCategory = cat; renderCategoryTabs(); filterAndRender(); });
          categoryTabsEl.appendChild(btn);
        });
      }

      // Render grid
      function renderMenuGrid() {
        menuGrid.innerHTML = '';
        if (loadingMenu) {
          for (let i=0;i<6;i++) {
            const skeleton = document.createElement('div');
            skeleton.className = 'bg-white/5 border-white/10 p-6 rounded-xl animate-pulse';
            skeleton.innerHTML = '<div class="w-full h-48 bg-white/10 rounded-lg mb-4"></div><div class="h-6 bg-white/10 rounded mb-2"></div><div class="h-4 bg-white/10 rounded w-2/3"></div>';
            menuGrid.appendChild(skeleton);
          }
          return;
        }

        if (filteredItems.length === 0) {
          const empty = document.createElement('div');
          empty.className = 'text-center py-12 col-span-full';
          empty.innerHTML = '<div class="text-gray-400">No items found. Try adjusting your filters.</div>';
          menuGrid.appendChild(empty);
          return;
        }

        filteredItems.forEach(item => {
          const card = document.createElement('div');
          card.className = 'group bg-white/5 border-white/10 hover:border-purple-500/50 hover:bg-white/10 transition-all overflow-hidden cursor-pointer rounded-xl';
          let imageHtml = '';
          if (item.image_url) {
            imageHtml = `<div class="relative h-48 overflow-hidden"><img src="${item.image_url}" alt="${escapeHtml(item.name)}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"/><div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-transparent"></div><div class="absolute top-3 right-3 px-2 py-1 rounded-md text-xs font-semibold text-white" style="background:linear-gradient(90deg, rgba(0,0,0,0.25), rgba(0,0,0,0.25));">${moodEmoji[item.mood_tag] || ''} ${escapeHtml(item.mood_tag || '')}</div></div>`;
          }
          const dietaryHtml = (item.dietary_info || []).map(info => `<span class="inline-block text-xs px-2 py-1 rounded-full border border-green-500/30 text-green-400 mr-2">${escapeHtml(info)}</span>`).join('');
          card.innerHTML = `${imageHtml}<div class="p-6"><div class="flex items-start justify-between mb-2"><h3 class="text-xl font-bold text-white group-hover:text-purple-400 transition-colors">${escapeHtml(item.name)}</h3><span class="text-xl font-bold text-amber-400">${formatPrice(item.price)}</span></div>${item.description ? `<p class="text-gray-400 text-sm mb-3">${escapeHtml(item.description)}</p>` : ''}<div class="flex items-center gap-2"> <span class="inline-block text-xs px-2 py-1 rounded bg-white/5 text-gray-300 border border-white/10">${escapeHtml(item.category)}</span>${dietaryHtml}</div></div>`;
          menuGrid.appendChild(card);
        });
      }

      function escapeHtml(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
      function formatPrice(p) { return '$' + (Number(p) || 0).toFixed(2); }

      function filterAndRender() {
        filteredItems = menuItems.filter(item => {
          if (searchQuery) {
            const q = searchQuery.toLowerCase();
            if (!(item.name.toLowerCase().includes(q) || (item.description || '').toLowerCase().includes(q))) return false;
          }
          if (selectedMood !== 'all' && item.mood_tag !== selectedMood) return false;
          if (selectedCategory !== 'all' && item.category !== selectedCategory) return false;
          return true;
        });
        renderMenuGrid();
      }

      // Simulate loading items (in real app use fetch / API)
      function loadMenuItems() {
        loadingMenu = true;
        renderMenuGrid();
        setTimeout(() => {
          menuItems = sampleMenu;
          loadingMenu = false;
          filterAndRender();
        }, 600);
      }

      // Wire search
      searchInput.addEventListener('input', (e) => { searchQuery = e.target.value; filterAndRender(); });

      // Initial render of filters/tabs and load
      renderMoodFilters();
      renderCategoryTabs();
      loadMenuItems();

      // Expose a small API so AI placeholder can change mood if needed
      window.__moodMenu = {
        setMood(m) { selectedMood = m; renderMoodFilters(); filterAndRender(); }
      };
      })();

      /* ---------------------- Zones Page Logic ---------------------- */
      (function() {
        // Configurable API endpoints - change these to your real API URLs
        // If you don't have an API yet, the script will fall back to sample static data.
        const API = {
          ZONES_URL: window.ZONES_API_URL || '/api/zones', // GET will return JSON array of zones
          BOOKING_URL: window.BOOKING_API_URL || '/api/bookings' // POST booking payload
        };

        const zonesContainerId = 'zones-page-dynamic';

        // Insert Zones section into the page (after the existing "Featured Zones")
        const zonesSection = document.createElement('section');
        zonesSection.id = 'zones-page';
        zonesSection.className = 'py-20 px-4 bg-slate-900/30';
        zonesSection.innerHTML = `
          <div class="max-w-7xl mx-auto">
            <div class="text-center mb-12">
              <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Immersive Experience Zones (Live)</h2>
              <p class="text-xl text-gray-400">Load zones from an API (configurable) or use local sample data.</p>
            </div>
            <div id="${zonesContainerId}" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            <div class="text-center mt-8"><small class="text-gray-400">Tip: set <code>window.ZONES_API_URL</code> and <code>window.BOOKING_API_URL</code> before this script runs to connect to your API.</small></div>
          </div>
        `;
        // Place the new zones section before the CTA section (find CTA by its button id)
        const signupBtn = document.getElementById('signupBtn');
        if (signupBtn && signupBtn.closest('section')) {
          signupBtn.closest('section').parentNode.insertBefore(zonesSection, signupBtn.closest('section'));
        } else {
          document.querySelector('.min-h-screen').appendChild(zonesSection);
        }

        const zonesGrid = document.getElementById(zonesContainerId);

        // Sample fallback zones (shape matches your React model)
        const sampleZones = [
          { id: 'z1', name: 'Couple Pod', type: 'couple_pod', description: 'Private intimate space with mood lighting.', image_url: 'https://images.unsplash.com/photo-1517457373958-b7bdd4587205?w=1200', capacity: 2, hourly_rate: 12, features: ['Mood lighting','Privacy curtain'] },
          { id: 'z2', name: 'Silent Pod', type: 'silent_pod', description: 'Noise-free sanctuary for focused work.', image_url: 'https://images.unsplash.com/photo-1497366754035-f200968a6e72?w=1200', capacity: 1, hourly_rate: 6, features: ['Desk','Power outlets'] },
          { id: 'z3', name: 'Game Arena', type: 'game_zone', description: 'Immersive gaming with smart LED tables.', image_url: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?w=1200', capacity: 6, hourly_rate: 25, features: ['LED tables','Controllers'] }
        ];

        function formatZoneCard(zone) {
          const colorClass = {
            couple_pod: 'from-pink-500 to-rose-500',
            silent_pod: 'from-blue-500 to-cyan-500',
            pet_zone: 'from-amber-500 to-orange-500',
            tech_zone: 'from-purple-500 to-indigo-500',
            game_zone: 'from-red-500 to-pink-500',
            smart_table: 'from-green-500 to-emerald-500'
          }[zone.type] || 'from-purple-600 to-pink-600';

          return `
            <div class="overflow-hidden bg-white/5 border border-white/10 rounded-xl group">
              <div class="relative h-56 overflow-hidden">
                ${zone.image_url ? `<img src="${zone.image_url}" alt="${escapeHtml(zone.name)}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"/>` : `<div class="w-full h-full bg-gradient-to-br ${colorClass}"></div>`}
                <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/50 to-transparent"></div>
                <div class="absolute top-4 right-4 bg-white/10 p-3 rounded-xl text-white">${escapeHtml(zone.type.replace(/_/g,' '))}</div>
              </div>
              <div class="p-6">
                <h3 class="text-2xl font-bold text-white mb-2">${escapeHtml(zone.name)}</h3>
                <p class="text-gray-400 mb-3">${escapeHtml(zone.description || '')}</p>
                <div class="grid grid-cols-2 gap-3 mb-4">
                  <div class="bg-white/5 rounded-lg p-3 text-sm text-gray-300">Capacity<br/><span class="text-white font-semibold">${zone.capacity || '-'}</span></div>
                  <div class="bg-white/5 rounded-lg p-3 text-sm text-gray-300">Rate<br/><span class="text-white font-semibold">$${(zone.hourly_rate||0)}/hr</span></div>
                </div>
                <div class="flex gap-2">
                  <button class="book-btn w-full py-2 rounded bg-gradient-to-r ${colorClass} text-white" data-zone-id="${escapeHtml(zone.id)}">Book This Zone</button>
                </div>
              </div>
            </div>
          `;
        }

        function renderZones(list) {
          zonesGrid.innerHTML = '';
          list.forEach(z => {
            const wrapper = document.createElement('div');
            wrapper.innerHTML = formatZoneCard(z);
            zonesGrid.appendChild(wrapper.firstElementChild);
          });

          // expose current zones for parent/other scripts
          try { window.__zonesData = list; } catch(e) { /* ignore */ }

          // attach book handlers
          zonesGrid.querySelectorAll('.book-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = btn.getAttribute('data-zone-id');
              const zone = list.find(x => String(x.id) === String(id));
              openBookingModal(zone);
            });
          });
        }

        // attempt to fetch zones from API, fallback to sample data
        async function loadZonesFromApi() {
          try {
            const res = await fetch(API.ZONES_URL, { method: 'GET' });
            if (!res.ok) throw new Error('Non-OK HTTP status ' + res.status);
            const data = await res.json();
            if (!Array.isArray(data) || data.length === 0) throw new Error('Empty or invalid data');
            renderZones(data);
            return;
          } catch (err) {
            console.warn('Zones API fetch failed, using sample data. Error:', err.message);
            renderZones(sampleZones);
          }
        }

        // Booking modal (simple)
        const modalHtml = `
          <div id="zoneBookingModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60">
            <div class="bg-slate-950 rounded-xl p-6 max-w-md w-full border border-white/10">
              <h3 id="modalZoneName" class="text-xl font-bold text-white mb-2">Book Zone</h3>
              <p id="modalZoneDesc" class="text-gray-400 mb-4"></p>
              <label class="text-sm text-gray-300">Your name</label>
              <input id="bookingName" class="w-full mb-3 mt-1 px-3 py-2 rounded bg-white/5 text-white border border-white/10" />
              <label class="text-sm text-gray-300">Date & Time</label>
              <input id="bookingDatetime" type="datetime-local" class="w-full mb-4 mt-1 px-3 py-2 rounded bg-white/5 text-white border border-white/10" />
              <div class="flex gap-3 justify-end">
                <button id="bookingCancel" class="px-4 py-2 rounded bg-white/5 text-gray-300">Cancel</button>
                <button id="bookingConfirm" class="px-4 py-2 rounded bg-purple-600 text-white">Confirm Booking</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHtml);

        const modal = document.getElementById('zoneBookingModal');
        const modalZoneName = document.getElementById('modalZoneName');
        const modalZoneDesc = document.getElementById('modalZoneDesc');
        const bookingName = document.getElementById('bookingName');
        const bookingDatetime = document.getElementById('bookingDatetime');
        const bookingCancel = document.getElementById('bookingCancel');
        const bookingConfirm = document.getElementById('bookingConfirm');

        let currentBookingZone = null;

        function openBookingModal(zone) {
          currentBookingZone = zone;
          modalZoneName.textContent = `Book: ${zone.name}`;
          modalZoneDesc.textContent = zone.description || '';
          bookingName.value = '';
          bookingDatetime.value = '';
          modal.classList.remove('hidden');
          modal.classList.add('flex');
        }
        // expose helper so other frames/scripts can open the booking modal with a zone object
        try { window.openBookingModal = openBookingModal; } catch(e) { /* ignore */ }

        function closeBookingModal() {
          modal.classList.remove('flex');
          modal.classList.add('hidden');
          currentBookingZone = null;
        }

        bookingCancel.addEventListener('click', closeBookingModal);

        bookingConfirm.addEventListener('click', async () => {
          const payload = {
            zone_id: currentBookingZone?.id,
            name: bookingName.value || 'Guest',
            datetime: bookingDatetime.value || new Date().toISOString()
          };

          // Try to post to API if configured, otherwise just show confirmation
          try {
            const res = await fetch(API.BOOKING_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            if (!res.ok) throw new Error('Booking API returned ' + res.status);
            const data = await res.json();
            showToast('Booking confirmed! Reference: ' + (data.id || JSON.stringify(data)), 'success');
          } catch (err) {
            console.warn('Booking API failed or not configured. Error:', err.message);
            showToast('Booking simulated locally. Payload: ' + JSON.stringify(payload), 'info');
          }

          closeBookingModal();
        });

        // Escape helper
        function escapeHtml(s) { return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

        // Load zones
        loadZonesFromApi();

        // Expose for debugging
        window.__zonesDebug = { API, loadZonesFromApi };
      })();

      // Dashboard removed per user request (mood box experience dashboard)

    /* ---------------------- Events Page Logic ---------------------- */
      (function(){
        const API = {
          EVENTS_URL: window.EVENTS_API_URL || '/api/events',
          REGISTER_URL: window.EVENTS_REGISTER_URL || '/api/registrations'
        };

        const eventsSectionId = 'events-page-live';
        const eventsContainerId = 'eventsContainerLive';

        const eventsSection = document.createElement('section');
        eventsSection.id = eventsSectionId;
        eventsSection.className = 'py-20 px-4 bg-slate-900/10';
        eventsSection.innerHTML = `
          <div class="max-w-7xl mx-auto">
            <div class="text-center mb-12">
              <h2 class="text-4xl md:text-5xl font-bold text-white mb-4">Events & Experiences (Live)</h2>
              <p class="text-xl text-gray-400 max-w-3xl mx-auto">Load events from an API (configurable) or use local sample data</p>
            </div>
            <div id="eventsCategoryTabs" class="mb-8 inline-flex bg-white/5 border border-white/10 rounded-lg overflow-hidden"></div>
            <div id="${eventsContainerId}" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
          </div>
        `;

        // insert after upcoming events static section or before CTA
        const cta = document.querySelector('button#signupBtn')?.closest('section');
        if (cta && cta.parentNode) cta.parentNode.insertBefore(eventsSection, cta);
        else document.querySelector('.min-h-screen').appendChild(eventsSection);

        const eventsGrid = document.getElementById(eventsContainerId);
        const categoryTabsEl = document.getElementById('eventsCategoryTabs');

        const categories = ['all', 'live_music','pet_adoption','mood_theme','game_night','workshop','special'];

        const sampleEvents = [
          { id:'e1', title:'Live Jazz Night', category:'live_music', description:'Smooth jazz evening paired with signature blends.', image_url:'https://images.unsplash.com/photo-1519681393784-d120267933ba?w=1200', event_date: new Date(Date.now()+7*24*3600*1000).toISOString(), start_time:'19:00', end_time:'22:00', capacity:80, price:20, featured:true },
          { id:'e2', title:'Board Game Tournament', category:'game_night', description:'Friendly competition with prizes.', image_url:'https://images.unsplash.com/photo-1542856391-6f4d3ed3e9d6?w=1200', event_date: new Date(Date.now()+14*24*3600*1000).toISOString(), start_time:'18:00', capacity:40, price:5, featured:false },
          { id:'e3', title:'Latte Art Workshop', category:'workshop', description:'Hands-on session to craft beautiful lattes.', image_url:'https://images.unsplash.com/photo-1527766833261-b09c3163a791?w=1200', event_date: new Date(Date.now()-10*24*3600*1000).toISOString(), start_time:'11:00', capacity:12, price:15, featured:false }
        ];

        function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

        function renderCategoryTabs(selected='all'){
          categoryTabsEl.innerHTML = '';
          categories.forEach(cat=>{
            const btn = document.createElement('button');
            btn.type='button';
            btn.className = cat===selected ? 'px-4 py-2 bg-purple-600 text-white' : 'px-4 py-2 text-gray-300';
            btn.textContent = cat.replace(/_/g,' ').toUpperCase();
            btn.addEventListener('click', ()=>{ currentCategory = cat; renderCategoryTabs(cat); filterAndRender(); });
            categoryTabsEl.appendChild(btn);
          });
        }

        let eventsList = [];
        let filteredEvents = [];
        let currentCategory = 'all';

        function formatDate(iso){ try{ return new Date(iso).toLocaleDateString(undefined,{ weekday:'long', year:'numeric', month:'long', day:'numeric' }); }catch(e){ return iso; } }

        function renderEvents(){
          eventsGrid.innerHTML = '';
          if(filteredEvents.length===0){ eventsGrid.innerHTML = '<div class="text-center py-12 col-span-full text-gray-400">No events found.</div>'; return; }
          filteredEvents.forEach(ev=>{
            const isPast = new Date(ev.event_date) < new Date();
            const card = document.createElement('div');
            card.className = 'group bg-white/5 border-white/10 hover:border-purple-500/50 hover:bg-white/10 transition-all overflow-hidden h-full flex flex-col rounded-xl';
            card.innerHTML = `
              <div class="relative h-56 overflow-hidden">
                ${ev.image_url ? `<img src="${ev.image_url}" alt="${escapeHtml(ev.title)}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"/>` : `<div class="w-full h-full bg-gradient-to-br from-purple-600 to-pink-600"></div>`}
                <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/50 to-transparent"></div>
                ${ev.featured ? '<div class="absolute top-4 left-4 bg-amber-500 text-white px-3 py-1 rounded">Featured</div>' : ''}
                ${isPast ? '<div class="absolute bottom-4 left-4 bg-gray-500 text-white px-2 py-1 rounded">Past Event</div>' : ''}
              </div>
              <div class="p-6 flex-1 flex flex-col">
                <div class="mb-3 text-sm text-purple-400 font-semibold">${escapeHtml(ev.category || '').replace(/_/g,' ').toUpperCase()}</div>
                <h3 class="text-2xl font-bold text-white mb-3">${escapeHtml(ev.title)}</h3>
                <p class="text-gray-400 mb-4 flex-1">${escapeHtml(ev.description || '')}</p>
                <div class="space-y-2 mb-4 text-gray-300">
                  <div><strong>Date:</strong> ${formatDate(ev.event_date)}</div>
                  ${ev.start_time?`<div><strong>Time:</strong> ${escapeHtml(ev.start_time)}${ev.end_time?` - ${escapeHtml(ev.end_time)}`:''}</div>`:''}
                  ${ev.capacity?`<div><strong>Capacity:</strong> Up to ${escapeHtml(ev.capacity)}</div>`:''}
                </div>
                <div class="flex items-center justify-between pt-4 border-t border-white/10">
                  <div class="flex items-center gap-2">${ev.price>0?`<span class="text-xl font-bold text-amber-400">$${escapeHtml(ev.price)}</span>`:'<div class="bg-green-500/20 text-green-400 px-2 py-1 rounded">FREE</div>'}</div>
                  ${isPast ? '' : `<button class="register-btn px-4 py-2 rounded bg-gradient-to-r from-purple-600 to-pink-600 text-white" data-event-id="${escapeHtml(ev.id)}">Register</button>`}
                </div>
              </div>
            `;
            eventsGrid.appendChild(card);
          });

          // wire register buttons
          eventsGrid.querySelectorAll('.register-btn').forEach(btn=>{
            btn.addEventListener('click', ()=>{
              const id = btn.getAttribute('data-event-id');
              const ev = eventsList.find(x=>String(x.id)===String(id));
              openRegisterModal(ev);
            });
          });
        }

        async function loadEventsFromApi(){
          try{
            const res = await fetch(API.EVENTS_URL, { method:'GET' });
            if(!res.ok) throw new Error('HTTP '+res.status);
            const data = await res.json();
            if(!Array.isArray(data) || data.length===0) throw new Error('Empty data');
            eventsList = data;
          }catch(err){
            console.warn('Events API failed, using sample events:', err.message);
            eventsList = sampleEvents;
          }
          filterAndRender();
        }

        function filterAndRender(){
          if(currentCategory==='all') filteredEvents = eventsList.slice();
          else filteredEvents = eventsList.filter(e=>e.category===currentCategory);
          // sort by date ascending
          filteredEvents.sort((a,b)=> new Date(a.event_date)-new Date(b.event_date));
          renderEvents();
        }

        // registration modal
        const regModalHtml = `
          <div id="eventRegModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60">
            <div class="bg-slate-950 rounded-xl p-6 max-w-md w-full border border-white/10">
              <h3 id="regModalTitle" class="text-xl font-bold text-white mb-2">Register</h3>
              <p id="regModalDesc" class="text-gray-400 mb-4"></p>
              <input id="regName" placeholder="Your name" class="w-full mb-3 mt-1 px-3 py-2 rounded bg-white/5 text-white border border-white/10" />
              <input id="regEmail" placeholder="Your email" class="w-full mb-3 mt-1 px-3 py-2 rounded bg-white/5 text-white border border-white/10" />
              <div class="flex gap-3 justify-end">
                <button id="regCancel" class="px-4 py-2 rounded bg-white/5 text-gray-300">Cancel</button>
                <button id="regConfirm" class="px-4 py-2 rounded bg-purple-600 text-white">Confirm</button>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', regModalHtml);
        const regModal = document.getElementById('eventRegModal');
        const regModalTitle = document.getElementById('regModalTitle');
        const regModalDesc = document.getElementById('regModalDesc');
        const regName = document.getElementById('regName');
        const regEmail = document.getElementById('regEmail');
        const regCancel = document.getElementById('regCancel');
        const regConfirm = document.getElementById('regConfirm');
        let currentEvent = null;

        function openRegisterModal(ev){
          currentEvent = ev; regModalTitle.textContent = `Register: ${ev.title}`; regModalDesc.textContent = ev.description||''; regName.value=''; regEmail.value=''; regModal.classList.remove('hidden'); regModal.classList.add('flex');
        }
        function closeRegisterModal(){ regModal.classList.remove('flex'); regModal.classList.add('hidden'); currentEvent=null; }
        regCancel.addEventListener('click', closeRegisterModal);

        regConfirm.addEventListener('click', async ()=>{
          const payload = { event_id: currentEvent?.id, name: regName.value||'Guest', email: regEmail.value||'', created_at: new Date().toISOString() };
          try{
            const res = await fetch(API.REGISTER_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
            if(!res.ok) throw new Error('HTTP '+res.status);
            const data = await res.json();
            showToast('Registration successful! Reference: '+(data.id||JSON.stringify(data)), 'success');
          }catch(err){
            console.warn('Registration API failed or not configured:', err.message);
            showToast('Registration simulated locally. Payload: '+JSON.stringify(payload), 'info');
          }
          closeRegisterModal();
        });

        // initial
        renderCategoryTabs();
        loadEventsFromApi();
        window.__eventsDebug = { API, loadEventsFromApi };
      })();
      // Zones iframe modal handlers
      (function(){
        const openBtn = document.getElementById('openAdvisorBtn');
        const modal = document.getElementById('zonesIframeModal');
        const closeBtn = document.getElementById('closeZonesIframe');
        if (openBtn && modal) {
          openBtn.addEventListener('click', (e)=>{
            e.preventDefault();
            modal.classList.remove('hidden');
            modal.classList.add('flex');
          });
        }
        if (closeBtn && modal) {
          closeBtn.addEventListener('click', ()=>{ modal.classList.remove('flex'); modal.classList.add('hidden'); });
        }
      })();

      // Initialize chatbot integration (improved visibility & parent toggle)
      (function(){
        // Expose data for chatbot (will fetch JSON entity files)
        window.__menuData = [];
        // zonesList and eventsList may be created by other scripts or API calls.
        // Use typeof checks to avoid ReferenceError when loaded from file:// or without APIs.
        window.__zonesData = (typeof zonesList !== 'undefined') ? zonesList : [];
        window.__eventsData = (typeof eventsList !== 'undefined') ? eventsList : [];

        // Try to load fallback JSON files if data is empty
        (function(){
          if ((!window.__zonesData || window.__zonesData.length === 0)) {
            fetch('entities/zones.json')
              .then(r => r.json())
              .then(d => { window.__zonesData = Array.isArray(d) ? d : [d]; })
              .catch(()=>{ console.warn('No fallback zones.json found or fetch blocked'); });
          }
          if ((!window.__eventsData || window.__eventsData.length === 0)) {
            fetch('entities/events.json')
              .then(r => r.json())
              .then(d => { window.__eventsData = Array.isArray(d) ? d : [d]; })
              .catch(()=>{ console.warn('No fallback events.json found or fetch blocked'); });
          }
        })();

        // Load menu items from entities/menuitem.json (if available)
        (function(){
          fetch('entities/menuitem.json')
            .then(res => res.json())
            .then(data => {
              // data is expected to be an array of menu items
              window.__menuData = Array.isArray(data) ? data : [data];
              // notify chatbot iframe if already present
              const f = document.getElementById('moodChatbotIframe');
              if (f && f.contentWindow) {
                f.contentWindow.postMessage({ type: 'dataLoaded', entity: 'menu', items: window.__menuData }, '*');
              }
            })
            .catch(err => {
              console.warn('Could not load entities/menuitem.json:', err.message);
            });
        })();

        // Create chatbot iframe (minimized by default)
        const chatbotFrame = document.createElement('iframe');
        chatbotFrame.id = 'moodChatbotIframe';
        chatbotFrame.src = 'smartchatbot.html';
        chatbotFrame.setAttribute('scrolling', 'no');
        chatbotFrame.style.border = 'none';
        chatbotFrame.style.position = 'fixed';
        chatbotFrame.style.bottom = '24px';
        chatbotFrame.style.right = '24px';
        chatbotFrame.style.width = '96px';
        chatbotFrame.style.height = '96px';
        chatbotFrame.style.zIndex = '100000';
        chatbotFrame.style.background = 'transparent';
        chatbotFrame.style.boxShadow = '0 10px 30px rgba(2,6,23,0.6)';
        chatbotFrame.style.borderRadius = '14px';
        chatbotFrame.style.overflow = 'hidden';
        chatbotFrame.style.pointerEvents = 'auto';
        document.body.appendChild(chatbotFrame);

        // Create a visible parent-level floating button to toggle the iframe
        const toggleBtn = document.createElement('button');
        toggleBtn.id = 'openChatParentBtn';
        toggleBtn.title = 'Open MoodBox Assistant';
        toggleBtn.style.position = 'fixed';
        toggleBtn.style.bottom = '24px';
        toggleBtn.style.right = '24px';
        toggleBtn.style.width = '64px';
        toggleBtn.style.height = '64px';
        toggleBtn.style.zIndex = '100001';
        toggleBtn.style.border = 'none';
        toggleBtn.style.borderRadius = '9999px';
        toggleBtn.style.cursor = 'pointer';
        toggleBtn.style.background = 'linear-gradient(90deg,#2563eb,#06b6d4)';
        toggleBtn.style.boxShadow = '0 10px 30px rgba(2,6,23,0.6)';
        toggleBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="white" stroke-width="1.8"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7A8.38 8.38 0 0 1 4 11.5 8.5 8.5 0 0 1 8.7 3.8"/></svg>';
        document.body.appendChild(toggleBtn);

        let isOpen = false;
        function openChat() {
          chatbotFrame.style.width = '420px';
          chatbotFrame.style.height = '600px';
          chatbotFrame.style.right = '24px';
          chatbotFrame.style.bottom = '24px';
          chatbotFrame.style.borderRadius = '12px';
          // forward open command to iframe so it can animate internally
          chatbotFrame.contentWindow?.postMessage({ type: 'open' }, '*');
          // hide parent toggle button while expanded
          toggleBtn.style.display = 'none';
          isOpen = true;
        }
        function closeChat() {
          chatbotFrame.style.width = '96px';
          chatbotFrame.style.height = '96px';
          chatbotFrame.style.borderRadius = '14px';
          chatbotFrame.contentWindow?.postMessage({ type: 'close' }, '*');
          // show toggle button again
          toggleBtn.style.display = 'block';
          isOpen = false;
        }

        toggleBtn.addEventListener('click', (e) => {
          e.preventDefault();
          if (!isOpen) openChat(); else closeChat();
        });

        // Handle messages from chatbot iframe
        window.addEventListener('message', (event) => {
          const data = event.data || {};
          if (data.type === 'resize' && typeof data.width === 'number' && typeof data.height === 'number') {
            chatbotFrame.style.width = data.width + 'px';
            chatbotFrame.style.height = data.height + 'px';
          }
          // allow iframe to request parent to open (useful if chat triggers from inside)
          if (data.type === 'openParent') {
            openChat();
          }
        });
      
        // -- Client-side 'page' navigation and UI wiring
        (function(){
          const sections = {
            hero: document.querySelector('section.relative.h-screen'),
            'menu': document.getElementById('menu'),
            'menu-page': document.getElementById('menu-page'),
            'zones': document.getElementById('zones'),
            'events': document.getElementById('events'),
            'gallery': document.getElementById('gallery')
          };

          function hideAll() {
            Object.values(sections).forEach(s => { if (s) s.style.display = 'none'; });
          }

          function showSection(id) {
            hideAll();
            const s = sections[id];
            if (s) {
              s.style.display = 'block';
              window.scrollTo({ top: 0, behavior: 'smooth' });
            }
          }

          // Attach nav button handlers (delegated to avoid click issues)
          const topNavEl = document.getElementById('topNav');
          if (topNavEl) {
            topNavEl.addEventListener('click', (e) => {
              const btn = e.target.closest('.navBtn');
              if (!btn) return;
              e.preventDefault();
              const target = btn.getAttribute('data-target');
              if (target) showSection(target);
            });
          }

          // Hero Explore Menu button -> open menu page (CTA) and reveal grid
          const heroExplore = document.getElementById('heroExploreMenu');
          const exploreMenuBtn = document.getElementById('exploreMenuBtn');
          const menuGrid = document.getElementById('menuGrid');
          const menuCta = document.getElementById('menuCta');

          if (heroExplore) heroExplore.addEventListener('click', (e) => { e.preventDefault(); window.location.href = 'menu.html'; });

          // menu section Explore button -> navigate to full menu page
          const menuSectionExplore = document.getElementById('menuSectionExploreBtn');
          if (menuSectionExplore) menuSectionExplore.addEventListener('click', (e) => { e.preventDefault(); window.location.href = 'menu.html'; });

          if (exploreMenuBtn) {
            exploreMenuBtn.addEventListener('click', () => {
              window.location.href = 'menu.html';
              menuGrid.classList.remove('hidden');
              menuGrid.style.display = 'grid';
              loadMenuItems();
            });
          }

          // Mood cards: open menu and filter by the clicked mood
          document.querySelectorAll('#menu .card').forEach(card => {
            card.style.cursor = 'pointer';
            card.addEventListener('click', () => {
              const mood = (card.querySelector('h3')||{textContent:''}).textContent.trim().toLowerCase();
              showSection('menu-page');
              // reveal and load items filtered by mood
              menuCta.style.display = 'none';
              menuGrid.classList.remove('hidden');
              menuGrid.style.display = 'grid';
              loadMenuItemsFiltered(mood);
            });
          });

          // Make other action buttons workable
          const exploreZonesBtn = document.getElementById('exploreZonesBtn');
          if (exploreZonesBtn) exploreZonesBtn.addEventListener('click', (e) => { e.preventDefault(); showSection('zones'); });

          const signupBtn = document.getElementById('signupBtn');
          if (signupBtn) signupBtn.addEventListener('click', () => { showToast('Sign up flow would open here (modal or redirect).', 'info'); });

          // Utility: load menu items from window.__menuData or entities file
          function loadMenuItems(){
            const grid = document.getElementById('menuGrid');
            if (!grid) return;
            grid.innerHTML = '';
            const items = window.__menuData && window.__menuData.length ? window.__menuData : [];
            if (!items.length) {
              // try to fetch fallback
              fetch('entities/menuitem.json').then(r=>r.json()).then(data=>{
                const list = Array.isArray(data)?data:[data];
                renderMenuItems(grid, list);
              }).catch(()=>{
                grid.innerHTML = '<p class="text-gray-400">No menu items available right now.</p>';
              });
            } else {
              renderMenuItems(grid, items);
            }
          }

          function renderMenuItems(grid, items){
            items.forEach(it => {
              const card = document.createElement('div');
              card.className = 'bg-white/5 border border-white/10 p-4 rounded-xl';
              card.innerHTML = `
                <div class="h-40 bg-cover bg-center rounded-lg mb-4" style="background-image:url('${it.image_url || ''}');"></div>
                <h4 class="text-xl font-bold mb-1">${it.name}</h4>
                <p class="text-sm text-gray-300 mb-3">${it.description || ''}</p>
                <div class="flex items-center justify-between">
                  <div class="text-purple-300 font-semibold">$${(it.price||0).toFixed(2)}</div>
                  <button class="px-3 py-1 bg-purple-600/80 rounded text-white bookItemBtn">Book</button>
                </div>
              `;
              grid.appendChild(card);
            });
            // attach book buttons
            grid.querySelectorAll('.bookItemBtn').forEach(btn => btn.addEventListener('click', ()=> showToast('Open booking flow for this item', 'info')));
          }

          function loadMenuItemsFiltered(mood){
            const grid = document.getElementById('menuGrid');
            grid.innerHTML = '';
            const items = (window.__menuData && window.__menuData.length) ? window.__menuData : [];
            const filtered = items.filter(i => (i.mood_tag||'').toLowerCase().includes(mood));
            if (filtered.length) renderMenuItems(grid, filtered);
            else {
              grid.innerHTML = `<p class="text-gray-400">No items found for "${mood}". Try exploring the full menu.</p>`;
            }
          }

          // Zone Booking Logic
          (function(){
            let selectedZone = null;
            const modal = document.getElementById('zoneBookingModal');
            const eventModal = document.getElementById('eventBookingModal');
            const form = document.getElementById('zoneBookingForm');
            const eventForm = document.getElementById('eventBookingForm');
            const seatsInput = document.getElementById('bookingSeats');
            const priceEl = document.getElementById('totalPrice');

            // Populate zone booking grid
            function renderZones(){
              const grid = document.getElementById('zoneBookingGrid');
              const zones = window.bookingManager.getZones();
              grid.innerHTML = zones.map(zone => `
                <div class="bg-white/5 border border-white/10 p-4 rounded-lg hover:bg-white/8 cursor-pointer transition-all" onclick="openZoneBooking('${zone.id}')">
                  <div class="h-32 bg-cover bg-center rounded mb-3 overflow-hidden" style="background-image:url('${zone.image}')"></div>
                  <div class="font-semibold text-white">${zone.name}</div>
                  <div class="text-xs text-gray-400 mb-2">${zone.description}</div>
                  <div class="flex items-center justify-between">
                    <div class="text-sm text-purple-300">Cap: ${zone.capacity}</div>
                    <div class="text-sm text-yellow-300">‚Çπ${zone.price}</div>
                  </div>
                </div>
              `).join('');
            }

            window.openZoneBooking = function(zoneId){
              selectedZone = window.bookingManager.getZones().find(z => z.id === zoneId);
              if(!selectedZone) return;
              document.getElementById('bookingZoneName').textContent = selectedZone.name;
              seatsInput.max = selectedZone.capacity;
              seatsInput.value = 1;
              updateZonePrice();
              modal.classList.remove('hidden');
              modal.classList.add('flex');
              document.getElementById('bookingName').focus();
            };

            window.closeZoneBooking = function(){
              modal.classList.add('hidden');
              modal.classList.remove('flex');
              form.reset();
              selectedZone = null;
            };

            function updateZonePrice(){
              const seats = Number(seatsInput.value || 1);
              const total = seats * (selectedZone?.price || 0);
              priceEl.textContent = total;
            }

            seatsInput.addEventListener('input', updateZonePrice);

            form.addEventListener('submit', function(e){
              e.preventDefault();
              const name = document.getElementById('bookingName').value.trim();
              const email = document.getElementById('bookingEmail').value.trim();
              const date = document.getElementById('bookingDate').value;
              const time = document.getElementById('bookingTime').value;
              const seats = Number(document.getElementById('bookingSeats').value);

              if(!selectedZone) return;
              const result = window.bookingManager.bookZone(selectedZone.id, name, email, date, time, seats);
              if(!result.ok){
                showToast(result.error, 'error');
                return;
              }
              // show confirmation modal with reference and copy button
              showBookingConfirmation(result.booking);
              window.closeZoneBooking();
              // sync to admin if present
              window.moodCafeAdmin?.addOrder({ user: name, total: result.booking.total, date: date, status: 'confirmed' });
            });

            // Event Booking
            const ticketsInput = document.getElementById('eventBookingTickets');
            const eventPriceEl = document.getElementById('eventTotalPrice');
            let selectedEvent = null;

            window.openEventBooking = function(eventId){
              selectedEvent = window.bookingManager.getEvents().find(e => e.id === eventId);
              if(!selectedEvent) return;
              document.getElementById('bookingEventName').textContent = selectedEvent.title;
              ticketsInput.max = selectedEvent.capacity - (selectedEvent.booked || 0);
              ticketsInput.value = 1;
              updateEventPrice();
              eventModal.classList.remove('hidden');
              eventModal.classList.add('flex');
              document.getElementById('eventBookingName').focus();
            };

            window.closeEventBooking = function(){
              eventModal.classList.add('hidden');
              eventModal.classList.remove('flex');
              eventForm.reset();
              selectedEvent = null;
            };

            function updateEventPrice(){
              const tickets = Number(ticketsInput.value || 1);
              const total = tickets * (selectedEvent?.price || 0);
              eventPriceEl.textContent = total;
            }

            ticketsInput.addEventListener('input', updateEventPrice);

            eventForm.addEventListener('submit', function(e){
              e.preventDefault();
              const name = document.getElementById('eventBookingName').value.trim();
              const email = document.getElementById('eventBookingEmail').value.trim();
              const tickets = Number(document.getElementById('eventBookingTickets').value);

              if(!selectedEvent) return;
              const result = window.bookingManager.bookEvent(selectedEvent.id, name, email, tickets);
              if(!result.ok){
                showToast(result.error, 'error');
                return;
              }
              showBookingConfirmation(result.booking);
              window.closeEventBooking();
              window.moodCafeAdmin?.addOrder({ user: name, total: result.booking.total, date: new Date().toISOString().split('T')[0], status: 'confirmed' });
            });

            // Booking confirmation modal handling
            function showBookingConfirmation(booking){
              const modal = document.getElementById('bookingConfirmationModal');
              const ref = document.getElementById('confirmRef');
              ref.textContent = booking.id + ' ‚Äî ' + (booking.type === 'zone' ? (booking.zoneName || '') : (booking.eventTitle || ''));
              modal.classList.remove('hidden');
              modal.classList.add('flex');
            }

            const copyRefBtn = document.getElementById('copyRefBtn');
            const closeConfirmBtn = document.getElementById('closeConfirmBtn');
            if(copyRefBtn){
              copyRefBtn.addEventListener('click', function(){
                const ref = document.getElementById('confirmRef').textContent || '';
                if(!ref) return;
                navigator.clipboard?.writeText(ref).then(()=>{
                  showToast('Reference copied to clipboard', 'success');
                }).catch(()=>{
                  showToast('Unable to copy reference', 'error');
                });
              });
            }
            if(closeConfirmBtn){
              closeConfirmBtn.addEventListener('click', function(){
                const modal = document.getElementById('bookingConfirmationModal');
                modal.classList.add('hidden');
                modal.classList.remove('flex');
              });
            }

            // Dev simulate booking button
            const simulateBtn = document.getElementById('simulateBookingBtn');
            if(simulateBtn){
              // show the button in local/testing environments
              simulateBtn.classList.remove('hidden');
              simulateBtn.addEventListener('click', function(){
                const zones = window.bookingManager.getZones();
                if(!zones || !zones.length){ showToast('No zones to simulate', 'error'); return; }
                const zone = zones[0];
                const res = window.bookingManager.bookZone(zone.id, 'Test User', 'test@example.com', new Date().toISOString().split('T')[0], '19:00', 1);
                if(res.ok){
                  showBookingConfirmation(res.booking);
                  window.moodCafeAdmin?.addOrder({ user: 'Test User', total: res.booking.total, date: res.booking.date || new Date().toISOString().split('T')[0], status: 'confirmed' });
                } else showToast(res.error || 'Sim failed', 'error');
              });
            }

            // Wire event buttons
            document.querySelectorAll('[data-event-book]').forEach(btn => {
              btn.addEventListener('click', () => window.openEventBooking(btn.getAttribute('data-event-book')));
            });

            // Initial render
            renderZones();

            // Listen for booking updates
            window.addEventListener('bookingManagerUpdate', () => {
              renderZones();
            });
          })();

          // Start with hero visible, hide other large sections to simulate pages
          hideAll();
          sections.hero.style.display = 'block';
        })();
      })();
  </script>
</body>
</html>

